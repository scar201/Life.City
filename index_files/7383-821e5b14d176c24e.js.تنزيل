"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7383],{9896:(e,t,n)=>{n.d(t,{F:()=>s});var a=n(27062),l=n(67933),r=n(7620),o=n(70011),i=n(85644);let s=()=>{let e="sticky-model-selector",{value:t}=(0,a.fS)("sticky_model_selector"),{value:n}=(0,a.fS)("model_selector_enabled"),{activeModelOptions:s}=(0,i.A9)(),u=(0,o.Z3)(null),c=(0,l.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let a=localStorage.getItem(e);return a===u?null:a&&s.find(e=>e.model===a)?a:null},initialData:null}),d=(0,r.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},17423:(e,t,n)=>{n.d(t,{M$:()=>c,O5:()=>i,f$:()=>s,lo:()=>u,n7:()=>d});var a=n(77186),l=n(1761),r=n(71473),o=n(87606);let i=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,a.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[r.ss,{orgUUID:t}]})},s=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[r.ss,{orgUUID:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,l.YL)(),i=null==n?void 0:n.uuid,s=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(i,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[r.ss,{orgUUID:i}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,i=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{i.invalidateQueries({queryKey:[r.ss,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},22529:(e,t,n)=>{n.d(t,{ClientIntlProvider:()=>p,O:()=>h,X5:()=>g,YX:()=>m,fl:()=>v});var a=n(54568),l=n(55428),r=n(68864),o=n(7620),i=n(88982),s=n(62971),u=n(18483);let c=new Set,d=e=>{if(e.message.includes("MISSING_TRANSLATION")){if(c.has(e.message))return;c.add(e.message)}console.error(e)},f=()=>void 0;function p(e){let{locale:t,messages:n,children:s,hideErrors:u}=e;return(0,o.useEffect)(()=>{r.wB.defaultLocale=t},[t]),(0,a.jsx)(i.A,{locale:t,messages:n,onError:u?f:(0,l.O0)()?d:void 0,fallbackOnEmptyString:!1,children:(0,a.jsx)(a.Fragment,{children:s})})}function m(e){let{id:t}=e;return(0,a.jsx)(s.A,{id:(0,u.ey)(t),defaultMessage:" "})}function g(e){let{id:t}=e;return(0,a.jsx)(s.A,{id:(0,u.lK)(t),defaultMessage:" "})}function v(e){let{id:t,intl:n}=e;return n.formatMessage({id:(0,u.lK)(t),defaultMessage:" "})}function h(e){let{id:t,intl:n}=e;return n.formatMessage({id:(0,u.ey)(t),defaultMessage:" "})}},32442:(e,t,n)=>{function a(e){let t=e,n="",a=0;for(;t!==n&&a<10;)n=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),a++;if(a>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}n.d(t,{M:()=>function e(t){if("string"==typeof t)return a(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[a,l]of Object.entries(t))n[e(a)]=e(l);return n}return t},P:()=>a})},33200:(e,t,n)=>{n.d(t,{N:()=>r});var a=n(27062),l=n(21036);function r(e){let t=(0,l.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1),{value:n}=(0,a.fS)("rely_on_analysis_flag"),{value:r}=(0,a.fS)("analysis_tool_launch_ga");if(n){var o;return{value:null!=(o=null==e?void 0:e.enabled_artifacts_attachments)?o:r,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}},42685:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>s,T:()=>i});var a=n(54568),l=n(7620),r=n(71165);let o=null;function i(){o&&o(!0)}function s(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>(o=t,()=>{o=null}),[]),(0,a.jsx)(r.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},45727:(e,t,n)=>{n.d(t,{p:()=>i});var a=n(19125),l=n(27062),r=n(17423);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,i=()=>{let{value:e}=(0,l.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,r.O5)(),i=(null==t?void 0:t.defaultStyles)||[],s=[...i,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[u,c,d]=(0,a.V)("claude_personalized_style",null);if(n||!(null==s?void 0:s.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e};let f=i.length?i.find(e=>!0===e.isDefault)||i[0]:null;if(e&&(f=i.find(e=>"Concise"===e.key)||f),!u)return{personalizedStyleOptions:s,defaultStyle:f,storedStyle:u,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e};let p=s.find(e=>o(e,u.styleKey)),m=Date.now()-new Date(u.timestamp).getTime()>432e5;return{personalizedStyleOptions:s,storedStyle:p&&!m?p:null,defaultStyle:f,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e}}},50707:(e,t,n)=>{n.d(t,{M:()=>o});var a=n(54568),l=n(32987),r=n(62971);function o(e){let{className:t,onClick:n,as:o="span"}=e;return(0,a.jsx)(o,{className:(0,l.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",n&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:n,children:(0,a.jsx)(r.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},52909:(e,t,n)=>{n.d(t,{CO:()=>f,M3:()=>u,bG:()=>c,ks:()=>m,pz:()=>s,z_:()=>d});var a=n(77186),l=n(1761),r=n(71473),o=n(87606),i=n(91768);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,l.YL)(),r=null==n?void 0:n.uuid,o=p(),s=(0,i.eL)();return(0,a.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];o(e),null==(n=t.onSuccess)||n.call(t,...l)},onError:function(){for(var e,n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];null==(e=t.onError)||e.call(t,...a);let[r,o]=a;s(r,o)}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,l.YL)(),r=null==n?void 0:n.uuid,o=p();return(0,a.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];o(e),null==(n=t.onSuccess)||n.call(t,...l)}})},c=e=>{let{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,o=p();return(0,a.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[r.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},d=e=>{let{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,o=p();return(0,a.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[r.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},f=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:s}=(0,l.YL)(),u=null==s?void 0:s.uuid,c=(0,o.useQueryClient)(),d=!!(s&&e&&n),{data:f,isLoading:p}=(0,a.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[r.LV,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(i.z3))?5e3:3e5},structuralSharing:(t,n)=>{let a=void 0!==t&&t.some(i.z3),l=void 0!==n&&n.some(i.z3);return a&&!l&&c.invalidateQueries({queryKey:[r.qz,{orgUuid:u,projectUuid:e}]}),n}});return{data:f,isLoading:!!d&&p}},p=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[r.LV,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[r._G,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[r.qz,{orgUuid:t,projectUuid:e}]})}},m=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(i.z3))}},57383:(e,t,n)=>{n.d(t,{_:()=>A,o:()=>M});var a=n(54568),l=n(66860),r=n(61125),o=n(74530),i=n(9896),s=n(77186),u=n(29585),c=n(7620),d=n(67455),f=n(98251),p=n(67094),m=n(52909),g=n(1761),v=n(51121),h=n(45727),y=n(42685),b=n(63056),_=n(72431),x=n(19125),w=n(32442);let S={type:"doc",content:[{type:"paragraph",content:[]}]},C=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),k=e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))},j=e=>{let t=(0,c.useCallback)(t=>{if(e&&!C(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&k(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,c.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},z=c.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,beamChatUuid:void 0,isNewBeamChat:!1,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,setBeamChatUuid:()=>void 0,setIsNewBeamChat:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),M=()=>c.useContext(z),A=e=>{var t,n,C,k,M,A,E;let{onSend:P,willRedirectOnSubmit:T,onCreate:L,onStopSampling:U,customFileUploadHandler:I}=e,{incognitoModeEnabled:N}=(0,_.S)(),O=(0,c.useRef)(null),D="conversation"in e,{children:F,projectUuid:Y,namespace:R}=e,K=D?e.conversation:void 0,{markMessageSent:Q}=(0,b.B)(),q=(0,c.useCallback)(()=>{D&&U&&U()},[U,D]);j(O.current);let{tipTapEditorState:B,setTipTapEditorText:V,setTipTapEditorJSON:G,isTipTapEditorStateUnsafe:J,attachments:W,setAttachments:X,files:Z,setFiles:H,syncSourceUuids:$,setSyncSourceUuids:ee,clear:et}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a="".concat(n?"".concat(n,":"):"").concat(e),[l,r,i]=(0,x.V)("".concat(a,":attachment"),[]),[s,u,d]=(0,x.V)("".concat(a,":files"),[]),[f,p,m]=(0,x.V)("".concat(a,":syncSourceUuids"),[]),[g,v,h]=(0,x.V)("".concat(a,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:S),y=(0,c.useCallback)(()=>!!g.__ant_unsafe,[g]),b=(0,c.useCallback)((e,t)=>{let n=(0,w.P)(e),a={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(a.__ant_unsafe=!0),v(a),n},[v]);return{attachments:l,setAttachments:r,files:s,setFiles:u,syncSourceUuids:f,setSyncSourceUuids:p,tipTapEditorState:g,setTipTapEditorJSON:(0,c.useCallback)(e=>{let t=(0,o.h0)(e);return t.length>0&&y()&&(e.__ant_unsafe=!0),v(e),t},[v,y]),setTipTapEditorText:b,isTipTapEditorStateUnsafe:y,clear:(0,c.useCallback)(()=>{h(),i(),d(),m()},[i,h,d,m])}}(null!=(n=null==K?void 0:K.id)?n:void 0===Y?"new-conversation":"".concat(Y,":conversation"),"",R),en=B?(0,o.h0)(B):"",[ea,el]=c.useState(en),er=(0,c.useCallback)(e=>{el(G(e))},[G,el]),eo=(0,c.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=V(e,n);if(el(a),!0===t){var l;null==(l=O.current)||l.setContent(a)}},[V]),ei=(0,d.NY)($),es=(0,d.qJ)(ei),eu=(0,s.B7)(ei),ec=W.length+Z.length+$.length>=l.Jn,[ed,ef]=c.useState(!1),[ep,em]=c.useState(),{stickyModelPreference:eg}=(0,i.F)(),ev=null!=(M=null!=(k=null!=(C=null==K?void 0:K.model)?C:ep)?k:eg)?M:void 0,[eh,ey]=c.useState(),eb=(0,c.useCallback)(e=>{ey(t=>({...t,...e}))},[]),[e_,ex]=c.useState(Y),ew=(0,p.Ah)(),{mutate:eS}=(0,f.nI)(),eC=(0,c.useCallback)(e=>{ex(e),ew&&e&&eS&&eS({project_uuid:e})},[ew,eS]),ek=(0,m.ks)(e_),[ej,ez]=c.useState(void 0),[eM,eA]=c.useState(!1),eE=(0,c.useCallback)(e=>{ez(e),e&&eA(!1)},[]),eP=(0,c.useCallback)(e=>{eA(e),e&&ez(void 0)},[]),[eT,eL]=c.useState(!1),[eU,eI]=c.useState(),[eN,eO]=c.useState(!1),[eD,eF]=c.useState(!1),[eY,eR]=c.useState(!1),{storedStyle:eK,defaultStyle:eQ}=(0,h.p)(),[eq,eB]=c.useState(),[eV,eG]=c.useState(!0),[eJ,eW]=c.useState();(0,c.useEffect)(()=>{let e=null!=eK?eK:eQ;!eq&&e&&eB(e)},[eK,eQ,eq]),(0,c.useEffect)(()=>{Y&&e_!==Y&&eC(Y)},[Y,e_,eC]);let eX="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,c.useEffect)(()=>{eI(void 0),eL(!1)},[null==K?void 0:K.id]),(0,c.useEffect)(()=>{null==eX||eX(eq)},[eq,eX]);let eZ=(0,c.useCallback)(async()=>{if(O.current&&(""!==ea.trim()||0!==W.length||0!==Z.length||0!==$.length)){T&&eI([...Z]),et(),el(""),T?O.current.setEditable(!1):O.current.setContent(""),eL(!0);try{Q(),D&&P?(await P({prompt:ea,attachments:W,files:Z,syncSources:eu,personalized_style:eq}),eL(!1),eI(void 0)):await L({prompt:ea,attachments:W,files:Z,syncSources:eu,model:ev,project_uuid:e_,is_new_beam_chat:eM||void 0,beam_chat_uuid:ej,personalized_style:eq,include_conversation_preferences:eV,is_temporary:N,...eh})}catch(t){var e;if(t instanceof u.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,y.T)();else throw t;eo(ea),null==(e=O.current)||e.setContent(ea),X(W),H(Z),ee($),O.current.setEditable(!0),eL(!1),eI(void 0)}}},[eh,W,et,Z,eV,D,ev,L,P,eq,e_,ea,X,H,eo,ee,$,eu,T,N,Q,eM,ej]),eH=(0,c.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&D){eL(!0);try{P&&(await P({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eq}),eL(!1))}catch(e){if(e instanceof u.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,y.T)();else throw e;eL(!1)}}},[D,P,eq]),{streamImprovement:e$,isStreaming:e0}=function(){let{activeOrganization:e}=(0,g.YL)(),[t,n]=(0,c.useState)(!1),[a,l]=(0,c.useState)(null),r=(0,c.useRef)(null),{addError:o}=(0,v.Y)(),i=(0,c.useCallback)(async(t,a,i,s)=>{r.current&&r.current.abort();let u=new AbortController;r.current=u,n(!0),l(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,f,p;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),l=new TextDecoder;if(!n)throw Error("No response body");let r="",o="",s=!1;for(;!s;){let e=await n.read();if(e.done){s=!0;break}let t=e.value,u=(r+=l.decode(t,{stream:!0})).split("\n");for(let e of(r=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(f=e.delta)?void 0:f.text)&&(o+=e.delta.text,a(e.delta.text));break;case"message_stop":i(e.improved_prompt||o);break;case"error":throw Error((null==(p=e.error)?void 0:p.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));l(e),null==s||s(e),o("Failed to improve prompt: "+e.message)}finally{n(!1),r.current===u&&(r.current=null)}},[null==e?void 0:e.uuid,o]);return(0,c.useEffect)(()=>()=>{r.current&&r.current.abort()},[]),{streamImprovement:i,isStreaming:t,error:a}}(),e1=(0,c.useCallback)(async()=>{var e,t,n,a;if(!ea.trim())return;null==(e=O.current)||e.setEditable(!1);let l="",r=!1;try{await e$({conversation_uuid:(null==K?void 0:K.id)||"new-conversation",prompt:ea},e=>{var t,n,a;r||(r=!0,eo(""),null==(a=O.current)||a.setContent("")),l+=e,eo(l,{forceUpdateTiptap:!1}),null==(t=O.current)||t.setContent(l),null==(n=O.current)||n.scrollToEnd()},e=>{var t;eo(e),null==(t=O.current)||t.setContent(e)},e=>{var t;eo(ea),null==(t=O.current)||t.setContent(ea)})}catch(e){eo(ea),null==(t=O.current)||t.setContent(ea)}finally{null==(n=O.current)||n.setEditable(!0),null==(a=O.current)||a.focus()}},[ea,null==K?void 0:K.id,e$,eo]),e2=(0,c.useCallback)(async e=>{if(em(e),D){eL(!0);try{var t;await L({prompt:ea,attachments:W,files:Z,syncSources:eu,model:e,project_uuid:e_,create_mode:null==K||null==(t=K.conversationSettings)?void 0:t.create_mode,...eh})}finally{eL(!1)}}},[eh,W,Z,D,e_,ea,L,eu,null==K||null==(t=K.conversationSettings)?void 0:t.create_mode]),e5=(0,c.useCallback)(()=>{var e;return null==(e=O.current)?void 0:e.focus()},[O]),[e6,e7]=c.useState(!1),e4=(0,r.cV)(),[e3,e8,e9,te,tt,tn,ta,tl]=(0,l.Si)({syncSourceCount:$.length,attachments:W,setAttachments:X,numExistingConversationAttachments:null!=(A=null==K?void 0:K.attachmentsSoFar)?A:0,files:Z,setFiles:H,numExistingConversationFiles:null!=(E=null==K?void 0:K.files.length)?E:0,detectSameAttachment:()=>!1,selectedModel:ev,blobFileUploadsEnabled:e4,customFileUploadHandler:I}),tr=W.length+Z.length,to=$.length,ti=e3||eD||eY,ts=tr>0||to>0||ti,tu=(0,c.useMemo)(()=>{var t;return{prompt:ea,tipTapEditorState:B,attachments:W,files:e.willRedirectOnSubmit&&eT?null!=eU?eU:[]:Z,syncSourceUuids:$,isAtMaxNumUploads:ec,isUploadingDriveSync:eD,isUploadingGithubSync:eY,model:ev,projectUuid:e_,beamChatUuid:ej,isNewBeamChat:eM,isChatSyncing:es,personalizedStyle:eq,isProjectSyncing:ek,isNewConversation:void 0===K||0===K.messagesSoFar,isProjectLocked:void 0!==Y||void 0!==K,isSending:eT,setPrompt:eo,setTipTapEditorState:er,setAttachments:X,setFiles:H,setSyncSourceUuids:ee,setModel:e2,setProjectUuid:eC,setBeamChatUuid:eE,setIsNewBeamChat:eP,sendMessage:eZ,sendTransparentMessage:eH,improvePrompt:e1,isImprovingPrompt:e0,stopSampling:q,conversation:K,focusInput:e5,isFocused:eN,setIsFocused:eO,promptInputRef:O,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:e6,setHasBlockingWarning:e7,setPersonalizedStyle:eB,setIsUploadingDriveSync:eF,setIsUploadingGithubSync:eR,includeProfilePreferences:eV,setIncludeProfilePreferences:eG,pendingConversationSettings:eh,setPendingConversationSettings:eb,isUploadingFile:e3,setIsUploadingFile:e8,validateMaxUploadLimit:e9,onDrop:te,onPasteFiles:tt,handleUpload:tn,uploadInputProps:tl,hasAttachments:ts,isModelSelectorOpen:ed,setIsModelSelectorOpen:ef,isPromptUnsafe:J,currentCompassTask:eJ,setCurrentCompassTask:eW}},[W,K,Z,e5,Y,e6,eV,ec,es,eN,ek,eT,eD,eY,ev,eq,e_,eC,ej,eM,ea,e.willRedirectOnSubmit,eZ,eH,e1,e0,X,H,e2,eh,eb,eE,eP,eo,ee,er,q,$,B,eU,e3,e8,e9,te,tt,tn,tl,ts,ed,ef,J,eJ,eW]);return(0,a.jsx)(z.Provider,{value:tu,children:F})}},61125:(e,t,n)=>{n.d(t,{F9:()=>M,QC:()=>_,_F:()=>c,cV:()=>A,cb:()=>w,cm:()=>h,eT:()=>j,kd:()=>k});var a=n(1761),l=n(2341),r=n(27062),o=n(33200);let i=[".DS_Store"],s=["jpg","jpeg","png","gif","webp"],u=["image/jpeg","image/png","image/gif","image/webp"],c={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip","doc","pptx"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],m=["docx","rtf","epub","odt","odp","pdf"],g=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],v=["csv"],h=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:n=!1,wiggleEnabled:a=!1}=e;return[...a?[".pptx",".doc",".docx",".zip"]:[],...m.map(e=>".".concat(e)),...b(),...t?y():[],...n?f.map(e=>".".concat(e)):[]]},y=()=>s.map(e=>".".concat(e)),b=()=>p.map(e=>".".concat(e)),_=e=>e.split(".").pop().toLowerCase(),x=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1}=t,l=_(e.name);return!!(!n&&(s.includes(l)||u.includes(e.type)))||(a?d.includes(l):[...d,...f].includes(l))},w=e=>{let t=_(e.name);return s.includes(t)||u.includes(e.type)},S=e=>[...v,...f].includes(_(e.name)),C=e=>!!i.includes(e.name),k=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1,rasterizePdfUploadsEnabled:l}=t,r=[],o=[],i=[],s=[],u=[],c=[];return e.filter(e=>!C(e)).forEach(e=>{let t=n&&w(e);x(e,{imagesEnabled:n,blobFileUploadsEnabled:a})?u.push(e):e.size>3e7?c.push(e):a&&S(e)?i.push(e):l&&("pdf"===_(e.name)||"application/pdf"===e.type)?s.push(e):j(e)?r.push(e):t?o.push(e):r.push(e)}),{attachmentUploads:r,imageUploads:o,rasterizedDocumentUploads:s,unsupportedUploads:u,tooLargeUploads:c,outOfContextFileUploads:i}},j=e=>{let t=_(e.name);return m.includes(t)||g.includes(e.type)},z=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,a=Math.min(t.length-1,1e3);for(let e=0;e<a;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let l=!0,r=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127)if(r=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){l=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){l=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){l=!1;break}e+=3}else{l=!1;break}}if(l&&r)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let a=e[n];a<32?t.control++:a<127?t.ascii++:a>127&&(t.nonAscii++,(a>=192&&a<=255||a>=168&&a<=183)&&t.cyrillic++,(a>=128&&a<=159||a>=160&&a<=255)&&t.latin1++)}return t})(t),i=o.cyrillic/o.total*100,s=o.latin1/o.total*100,u=o.ascii/o.total*100;if(o.nonAscii>0){if(i>.3)return"windows-1251";if(s>o.control/o.total*100)return"windows-1252"}return u>90&&o.control/o.total<.1?"ascii":"utf-8"},M=async e=>{let t=await e.arrayBuffer(),n=z(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function A(){var e;let{value:t}=(0,r.fS)("ooc_attachments"),{account:n}=(0,a.YL)(),i=(0,l.B)(),s=null!=(e=null!=i?i:null==n?void 0:n.settings)?e:{},{value:u}=(0,o.N)(s);return!!t&&u}},63056:(e,t,n)=>{n.d(t,{PerformanceMetricsProvider:()=>c,B:()=>d});var a=n(54568),l=n(56320);class r{getTracer(){return this.tracer||(this.tracer=l.u.getTracer("claude-ai-performance","1.0.0")),this.tracer}trackNewChatInputReady(e){let t=this.getTracer().startSpan("page.new_chat_input_ready");t.setAttributes({"performance.new_chat_input_ready.duration_ms":e,"performance.metric_type":"new_chat_input_ready"}),t.end()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getTracer().startSpan("chat.time_to_first_token"),a={"performance.ttft.duration_ms":e,"performance.metric_type":"ttft"};t.model&&(a["chat.model"]=t.model),n.setAttributes(a),n.end()}constructor(){this.tracer=null}}let o=new r;var i=n(62942),s=n(7620);let u=(0,s.createContext)(null);function c(e){let{children:t}=e,n=(0,i.usePathname)(),l=(0,s.useRef)(null),r=(0,s.useRef)(!1),c=(0,s.useRef)(null),d=(0,s.useRef)(!1);(0,s.useEffect)(()=>{"/new"===n&&(l.current=performance.now(),r.current=!1)},[n]);let f=(0,s.useCallback)(()=>{if(r.current||null===l.current)return;r.current=!0;let e=performance.now()-l.current;o.trackNewChatInputReady(e),l.current=null},[]),p=(0,s.useCallback)(()=>{c.current=performance.now(),d.current=!1},[]),m=(0,s.useCallback)(e=>{if(null===c.current||d.current)return;d.current=!0;let t=performance.now()-c.current;o.trackTTFT(t,e),c.current=null},[]),g=(0,s.useMemo)(()=>({markEditorReady:f,markMessageSent:p,markFirstTokenReceived:m}),[f,p,m]);return(0,a.jsx)(u.Provider,{value:g,children:t})}function d(){let e=(0,s.useContext)(u);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},66860:(e,t,n)=>{n.d(t,{Jn:()=>M,Si:()=>L,fU:()=>D,i1:()=>q,pD:()=>P,vV:()=>Y});var a=n(42977),l=n(54568),r=n(61125),o=n(70011),i=n(85644),s=n(98518),u=n(77186),c=n(1761),d=n(51121),f=n(90510),p=n(29242),m=n(29585),g=n(46612),v=n(71473),h=n(27062),y=n(69055),b=n(7033),_=n(70825),x=n(87606),w=n(7620),S=n(62971),C=n(46760),k=n(81133),j=n(17936);function z(){let e=(0,a._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return z=function(){return e},e}let M=20,A=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},E=e=>e.replace(/\0/g,""),P=e=>{e.extracted_content=E(e.extracted_content),e.file_name=E(e.file_name),e.file_type=E(e.file_type)},T=(e,t)=>({file_name:A(e),file_type:e.type,file_size:e.size,extracted_content:t});function L(e){let{syncSourceCount:t,files:n,setFiles:a,numExistingConversationFiles:s,attachments:u,setAttachments:c,numExistingConversationAttachments:f,detectSameAttachment:m,selectedModel:g,blobFileUploadsEnabled:v,customFileUploadHandler:_}=e,{addError:x}=(0,d.Y)(),k=(0,o.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:o,numExistingConversationAttachments:s,numExistingConversationFiles:u,selectedModel:c,blobFileUploadsEnabled:d,customFileUploadHandler:f}=e,m=(0,C.A)(),{modelConfig:g}=(0,i.fC)(c),{value:v}=(0,h.fS)("trials_and_tribulations_of_high_school_football"),_=v&&!1,x=g.image_in,[k,j,z,A]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:o,numExistingConversationFiles:s,selectedModel:u,blobFileUploadsEnabled:c,customFileUploadHandler:d}=e,{modelConfig:f}=(0,i.fC)(u),p=f.image_in,m=q()&&f.pdf_in,{isUploading:g,setIsUploading:v,handleError:h,handleUpload:y}=Y({imagesEnabled:p,blobFileUploadsEnabled:c,onUploadComplete:n,rasterizePdfUploadsEnabled:m,customFileUploadHandler:d}),b=(0,w.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:i=0,showError:u=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:g,outOfContextFileUploads:v}=(0,r.kd)(n,{imagesEnabled:p,blobFileUploadsEnabled:c,rasterizePdfUploadsEnabled:m});return i+d.length+f.length+g.length+v.length+a.length+o.length+t>M?(u&&h((0,l.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:M}})),!1):!(f.length+g.length+o.length+s>100)||(u&&h((0,l.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:s<100?(0,l.jsx)(S.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,l.jsx)(S.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,c,a,o,t,s,h,m]);return[g,v,b,(0,w.useCallback)(async e=>{b({newUploads:e})&&await y(e)},[y,b])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:a,numExistingConversationFiles:u,numExistingConversationAttachments:s,selectedModel:c,blobFileUploadsEnabled:d,customFileUploadHandler:f}),E=function(e){let{handleUpload:t}=e,n=(0,w.useRef)({ready:0,total:0}),a=(0,w.useCallback)(()=>{n.current={ready:0,total:0}},[]),l=(0,w.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),r=(0,w.useCallback)((e,t)=>{let a=e.length;for(let o=0;o<a;o++){let a=e[o];a.isFile?(n.current.total+=1,a.file(e=>{t.push(e),l(t)})):a.isDirectory&&a.createReader().readEntries(e=>{r(e,t)})}},[l]);return(0,w.useCallback)(e=>{var t;e.preventDefault(),a();let n=null==(t=e.dataTransfer)?void 0:t.items;if(!n)return;let l=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&l.push(t)}r(l,[])},[r,a])}({handleUpload:A}),P=(0,w.useCallback)(async e=>{await A(Array.from(e))},[A]),T=(0,w.useCallback)(async e=>{let t=e.target.files;t&&await A(Array.from(t)),e.target.value=""},[A]),L=x?(0,l.jsx)(S.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:M}}):(0,l.jsx)(S.A,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:M}}),U=(0,w.useCallback)(e=>{T(e)},[T]),I=(0,w.useMemo)(()=>({type:"file",accept:(0,r.cm)({imagesEnabled:x,outOfContextFilesEnabled:d,wiggleEnabled:_}).join(","),onChange:U,multiple:!0,"aria-label":m.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[x,d,_,U,m]);return[k,j,z,E,P,A,(0,l.jsx)(p.m,{className:"text-center",tooltipContent:L,children:(0,l.jsxs)(R,{children:[(0,l.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...I}),k?(0,l.jsx)(y.N,{className:"animate-spin",size:18}):(0,l.jsx)(b.x,{size:18,weight:"light"})]})},"upload-tooltip"),I]}({syncSourceCount:t,onUploadComplete:(0,w.useCallback)(async(e,t)=>{m&&e.find(e=>m(e.extracted_content))&&x((0,l.jsx)(S.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"})),c(t=>[...t,...e]),a(e=>[...e,...t])},[m,x,c,a]),existingAttachments:u,existingFiles:n,numExistingConversationAttachments:f,numExistingConversationFiles:s,selectedModel:null!=g?g:k,blobFileUploadsEnabled:v,customFileUploadHandler:_})}let U=async(e,t,n)=>{let a=new Image;if(a.src=URL.createObjectURL(e),await new Promise(e=>{a.onload=e,setTimeout(e,250)}),!a.width||!a.height||"image/png"!==e.type&&a.width<=t&&a.height<=n)return e;let l=a.width/a.height,r=a.width,o=a.height;a.width>t&&(o=(r=t)/l),o>n&&(r=(o=n)*l);let i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i);let s=i.getContext("2d");if(!s||!s.imageSmoothingQuality)return document.body.removeChild(i),e;s.imageSmoothingQuality="high",i.width=r,i.height=o,s.drawImage(a,0,0,r,o);let u=await new Promise(e=>{i.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(i),u)?new File([u],e.name,{type:"image/webp"}):e},I=()=>{let{value:e}=(0,h.fS)("use_canvas_resize");return(0,w.useCallback)(async t=>e?await U(t,2e3,2e3):t,[e])},N=()=>{let e=Q(),t=D();return async(n,a,l)=>{try{return await t(n,a,l)}catch(t){e(t,(0,r.cb)(n)?"image":"file")}}},O=e=>{let t=Q(),n=D(),a=(0,u.mn)();return async(l,r,o)=>{let i={};try{i.file=await n(l,r,o)}catch(n){n instanceof m.LG&&"document_too_many_pages"===n.errorCode?i.attachment=await K(a,l,r,e):t(n,"document")}return i}},D=()=>{let e=(0,u.mn)(),t=(0,x.useQueryClient)();return async(n,a,l)=>{let r=new FormData;r.append("file",n);let o=l?"/api/organizations/".concat(a,"/projects/").concat(l,"/upload"):"/api/".concat(a,"/upload"),i=await e(o,{method:"POST",body:r}),s=await i.json();if(i.ok)return l&&t.invalidateQueries({queryKey:[v.qz,{orgUuid:a,projectUuid:l}]}),s;throw(0,m.a5)(i.status,s,"File upload failed",i.headers)}},F=async(e,t,n,a)=>{let r,o=new FormData;o.append("file",t);try{r=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,_.Cp)(e),a((0,l.jsx)(S.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===r.status)return a((0,l.jsx)(S.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===r.status)return a((0,l.jsx)(S.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!r.ok)return a((0,l.jsx)(S.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let i=await r.json();return i&&0!==Object.keys(i).length&&i.extracted_content?(i.file_name=A(t),i):a((0,l.jsx)(S.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},Y=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:o,onUploadComplete:i,onError:f,projectUuid:p,customFileUploadHandler:m}=e,{activeOrganization:v}=(0,c.YL)(),h=null!=(t=null==v?void 0:v.uuid)?t:"",[y,b]=(0,w.useState)(!1),{addError:_}=(0,d.Y)(),x=(0,w.useCallback)(e=>{b(!1),_(e),f&&f()},[_,f,b]),C=I(),j=N(),z=O(x),M=(0,u.mn)(),A=(0,s.st)(),E=(0,w.useCallback)(async(e,t)=>{if(m){b(!0);try{let t=await m(e);t&&t.length>0&&await i([],t)}catch(e){x(e instanceof Error?e.message:"File upload failed")}finally{b(!1)}return}let{attachmentUploads:s,imageUploads:u,rasterizedDocumentUploads:c,unsupportedUploads:d,tooLargeUploads:f,outOfContextFileUploads:v}=(0,r.kd)(e,{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:o}),y=d.map(e=>(0,r.QC)(e.name));if(y.length>0)return x((0,l.jsx)(S.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:y.length,formats:(0,l.jsx)(k.dT,{type:"conjunction",value:[...new Set(y)]})}}));if(f.length>0)return A.track({event_key:"file_upload_too_large",large_files:f.map(e=>({file_type:e.type,file_size:e.size}))}),x((0,l.jsx)(S.A,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));b(!0);let _=[],w=0,E=(e,n)=>{if(void 0===t)return!0;let a=new Blob([n]).size/g.t2;return!((w+=a)>t)||(x((0,l.jsx)(S.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of s){let t=await K(M,e,h,x);if(!(t&&E(e.name,t.extracted_content)))return;await i([t],[])}for(let e of u){let t=await C(e),n=await j(t,h,p);n&&_.push(n)}for(let e of c){let{file:t,attachment:n}=await z(e,h,p);if(t&&_.push(t),n)if(!E(e.name,n.extracted_content))return;else await i([n],[])}for(let e of v){let t=await j(e,h,p);t&&_.push(t)}await i([],_),b(!1)},[a,M,i,n,x,j,z,h,C,A,o,p,m]);return{isUploading:y,setIsUploading:b,handleError:x,handleUpload:E}},R=f.J.label(z()),K=async(e,t,n,a)=>{if(!(0,r.eT)(t))try{let e=await (0,r.F9)(t);return T(t,e)}catch(e){}let l=await F(e,t,n,a);if(l)return P(l),l},Q=()=>{let{addError:e}=(0,d.Y)();return(0,w.useCallback)((t,n)=>{if(t instanceof m.LG){if("rate_limit_error"===t.type)return void e((0,l.jsxs)("p",{children:[(0,l.jsx)(S.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,l.jsx)(j.W,{})]}));if("document_password_protected"===t.errorCode)return void e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}))}if(t instanceof m.LG&&"Image is too large"===t.message)return void e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,l.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}))},[e])},q=()=>{let{value:e}=(0,h.fS)("janus_claude-ai");return e}},67094:(e,t,n)=>{n.d(t,{Ah:()=>w,I_:()=>j,L1:()=>y,Mf:()=>b,OC:()=>h,SK:()=>x,jg:()=>v,k0:()=>_,tW:()=>g,xt:()=>k});var a=n(68096),l=n(77186),r=n(1761),o=n(51121),i=n(22529),s=n(71473),u=n(27062),c=n(87606),d=n(46760),f=n(75006),p=n(98251);let m=f.z.object({memory:f.z.string(),user_instructions:f.z.string().nullable().optional(),updated_at:f.z.string().datetime({offset:!0}).nullable().optional()}),g=(e,t)=>{var n;let{account:a,activeOrganization:o}=(0,r.YL)(),i=null==a?void 0:a.uuid,u=null==o?void 0:o.uuid,c=b(),d=e?"/api/organizations/".concat(u,"/memory/synthesis?project_uuid=").concat(e):"/api/organizations/".concat(u,"/memory/synthesis"),{data:f,isPending:p}=(0,l.Sk)(d,{queryKey:[s.IX,{accountUUID:i,orgUUID:u,projectUUID:e}],enabled:!!o&&(null==(n=null==t?void 0:t.enabled)||n)&&c},e=>m.parse(e));return{...f,isPending:p}},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,r.YL)(),a=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,f=b(),{addError:p}=(0,o.Y)(),m=(0,d.A)(),g=(0,c.useQueryClient)(),{mutate:v,isPending:h}=(0,l.L2)("/api/organizations/".concat(u,"/memory/synthesize"),"POST",{enabled:!!n&&f,...e,onSuccess:function(){for(var t,n=arguments.length,l=Array(n),r=0;r<n;r++)l[r]=arguments[r];let[o,i]=l;g.invalidateQueries({queryKey:[s.IX,{accountUUID:a,orgUUID:u,projectUUID:i.project_uuid}]}),null==(t=e.onSuccess)||t.call(e,...l)},onError:function(){for(var t,n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];null==(t=e.onError)||t.call(e,...a),p((0,i.O)({id:"frigid_umbrella_sunflower",intl:m}))}});return{synthesizeMemory:v,isSynthesizingMemory:h}},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,r.YL)(),a=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,f=b(),{addError:p}=(0,o.Y)(),m=(0,d.A)(),g=(0,c.useQueryClient)(),{mutate:v,isPending:h}=(0,l.L2)("/api/organizations/".concat(u,"/memory/instructions"),"PUT",{enabled:!!n&&f,...e,onSuccess:function(){for(var t,n=arguments.length,l=Array(n),r=0;r<n;r++)l[r]=arguments[r];let[o,i]=l;g.invalidateQueries({queryKey:[s.IX,{accountUUID:a,orgUUID:u,projectUUID:i.project_uuid}]}),null==(t=e.onSuccess)||t.call(e,...l)},onError:function(){for(var t,n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];null==(t=e.onError)||t.call(e,...a),p((0,i.O)({id:"frigid_umbrella_sunflower",intl:m}))}});return{updateMemoryUserInstructions:v,updateMemoryUserInstructionsIsPending:h}},y=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=t?"/api/organizations/".concat(t,"/memory/themes"):null;return(0,l.Sk)(n,{staleTime:3e5,enabled:!!t&&!!n})},b=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_enabled");return e},_=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_themes_enabled");return e},x=()=>{var e;let{account:t}=(0,r.YL)(),n=b();return null!=(e=null==t?void 0:t.settings.enabled_saffron)?e:n},w=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_search_enabled");return e},S=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_search_default_enabled");return e},C=()=>{var e;let{account:t}=(0,r.YL)(),n=S();return null!=(e=null==t?void 0:t.settings.enabled_saffron_search)?e:n},k=()=>{let{account:e}=(0,r.YL)(),t=C(),n=w(),{mutate:l}=(0,a.Jy)(),{mutate:o}=(0,p.nI)();return{toggleSaffronSearch:()=>{let a=!t;l({...null==e?void 0:e.settings,enabled_saffron_search:a}),n&&a&&o&&o({})},saffronSearchEnabled:t}},j=()=>{let e=b(),t=w();return e||t}},67455:(e,t,n)=>{n.d(t,{EF:()=>g,NY:()=>f,Ql:()=>h,VA:()=>v,YO:()=>m,qJ:()=>p});var a=n(77186),l=n(1761),r=n(46612),o=n(71473),i=n(77101),s=n(87606),u=n(7620),c=n(91768),d=n(93049);let f=e=>{let{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,r=!!(t&&e.length>0),i=(0,u.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),s=(0,u.useMemo)(()=>({queryKey:e.map(e=>[o.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:r,refetchInterval:e=>!!(e.state.data&&(0,c.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[r,n,e]);return(0,a._i)(i,s)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,c.z3)(e.data)),m=e=>Math.ceil(f(e).reduce((e,t)=>{var n,a,l;return t.isLoading||!t.data?e:e+(null!=(l=null==(a=t.data)||null==(n=a.status)?void 0:n.current_size_bytes)?l:0)},0)/r.t2),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,l.YL)(),r=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,f=(0,s.useQueryClient)(),p=(0,c.eL)();return(0,a.L2)(()=>"/api/organizations/".concat(u,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,a,l,s,c=arguments.length,d=Array(c),p=0;p<c;p++)d[p]=arguments[p];let[m]=d;f.setQueryData([o.GC,{orgUuid:u,syncSourceUuid:m.uuid}],m),m.type===i.v8.GDRIVE&&m.config.uri&&(null==(t=m.status)?void 0:t.extra)&&(null==(n=m.status)?void 0:n.current_size_bytes)&&f.setQueryData([o.QB,{accountUUID:r,orgUUID:u,documentId:m.config.uri}],{uri:"drive:///".concat(m.config.uri),title:null==(l=m.status)?void 0:l.extra,size:null==(s=m.status)?void 0:s.current_size_bytes}),null==(a=e.onSuccess)||a.call(e,...d)},onError:function(){for(var t,n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];null==(t=e.onError)||t.call(e,...a);let[r,o]=a;p(r,o),o.sync_source_type===i.v8.GDRIVE&&(0,d.D8)(o.sync_source_config.uri)}})},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,r=(0,s.useQueryClient)();return(0,a.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,a=arguments.length,l=Array(a),i=0;i<a;i++)l[i]=arguments[i];let[s]=l;r.setQueryData([o.GC,{orgUuid:n,syncSourceUuid:s.uuid}],s),null==(t=e.onSuccess)||t.call(e,...l)}})},h=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},71165:(e,t,n)=>{n.d(t,{S:()=>f,v:()=>d});var a=n(54568),l=n(41417),r=n(76761),o=n(60265),i=n(62942),s=n(25173),u=n(62971),c=n(50707);function d(e){let{isOpen:t,onClose:n,limitType:d="projects",customTitle:f,customDescription:p}=e,m=(0,i.useRouter)(),g=["opus"===d?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===d&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===d&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,a.jsx)(s.bL,{open:t,onOpenChange:n,children:(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,a.jsxs)(s.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),n()},onInteractOutside:e=>{e.preventDefault(),n()},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,a.jsx)(c.M,{}),(0,a.jsx)(s.bm,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,a.jsx)(r.X,{size:20,weight:"regular"})})})]}),(0,a.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,a.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:f||("opus"===d?(0,a.jsx)(u.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):(0,a.jsx)(u.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,a.jsx)("p",{className:"text-base text-text-300 mb-3",children:p||("opus"===d?(0,a.jsx)(u.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):(0,a.jsx)(u.A,{defaultMessage:"Free plans only get access to one Project. Upgrade now to get:",id:"NOiyw9Bber"}))}),(0,a.jsx)("div",{className:"space-y-1.5 mb-6",children:g.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,a.jsx)(o.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,a.jsx)("span",{className:"text-sm text-text-200",children:(0,a.jsx)(u.A,{...e})})]},"benefit-".concat(t)))}),("opus"===d||"projects"===d)&&(0,a.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,a.jsx)("a",{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",className:"text-text-400 underline hover:text-text-300",children:(0,a.jsx)(u.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,a.jsx)(l.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{n(),m.push("/upgrade")},children:(0,a.jsx)(u.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let f=d},72431:(e,t,n)=>{n.d(t,{S:()=>d,r:()=>f});var a=n(54568),l=n(89256),r=n.n(l),o=n(62942),i=n(7620),s=n(67094);let u="incognito",c=i.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:r(),temporaryConversationUUID:null,setTemporaryConversationUUID:r()}),d=()=>i.useContext(c),f=e=>{let{children:t}=e,n=(0,o.useRouter)(),l=(0,o.useSearchParams)(),r=(0,s.I_)(),d=l.has(u),[f,p]=(0,i.useState)(d),m=(0,i.useRef)(f),[g,v]=(0,i.useState)(null);(0,i.useEffect)(()=>{m.current=f},[f]);let h=(0,i.useCallback)(e=>{if(p(e),e)n.push("?".concat(u));else{v(null);let e=new URLSearchParams(l.toString());e.delete(u);let t=e.toString();n.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}},[n,l]);(0,i.useEffect)(()=>{m.current&&!d&&h(!1)},[h,d]);let y=(0,i.useMemo)(()=>({incognitoModeEnabled:!!r&&f,setIncognitoModeEnabled:h,temporaryConversationUUID:r?g:null,setTemporaryConversationUUID:v}),[f,h,g,v,r]);return(0,a.jsx)(c.Provider,{value:y,children:t})}},74530:(e,t,n)=>{function a(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("​","")}:e.content?{...e,content:e.content.map(a)}:e}n.d(t,{DV:()=>a,h0:()=>l});let l=e=>{let t="",n=0,a=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)a(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)a(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)a(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)a(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)a(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(n);for(let i of(r?t+="".concat(o).concat(l,". "):t+="".concat(o,"* "),e.content))n+=1,a(i),n-=1}};return a(e),t.replace("​","").trim()}},85644:(e,t,n)=>{n.d(t,{A9:()=>p,Wq:()=>m,fC:()=>c});var a=n(77186),l=n(1761),r=n(71473),o=n(27062),i=n(85544),s=n(75006);let u={image_in:!0,pdf_in:!1},c=e=>{let{activeOrganization:t}=(0,l.YL)(),n=null==t?void 0:t.uuid,{data:o,isLoading:i,isPlaceholderData:s}=(0,a.Sk)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[r.yV,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}});return{isLoading:i,modelConfig:!s&&o||u}},d=s.z.array(s.z.object({model:s.z.string(),name:s.z.string(),description:s.z.string().optional(),description_i18n_key:s.z.string().optional(),notice_text:s.z.string().optional(),notice_text_i18n_key:s.z.string().optional(),inactive:s.z.boolean().optional(),overflow:s.z.boolean().optional(),knowledgeCutoff:s.z.string().optional(),slow_kb_warning_threshold:s.z.number().optional(),paprika_modes:s.z.array(i.T4).optional(),capabilities:s.z.object({mm_pdf:s.z.boolean().optional(),mm_images:s.z.boolean().optional(),web_search:s.z.boolean().optional(),gsuite_tools:s.z.boolean().optional(),compass:s.z.boolean().optional()}).optional()})),f=[],p=()=>{var e;let{value:t}=(0,o.fS)("backend_model_config"),{activeOrganization:n}=(0,l.YL)(),a=(0,o.T9)("claude_ai_models","models",f,d),r=t?null!=(e=null==n?void 0:n.claude_ai_bootstrap_models_config)?e:f:a,i=r.filter(e=>!e.inactive),s=i.filter(e=>!e.overflow),u=i.filter(e=>e.overflow);return{allModelOptions:r,activeModelOptions:i,mainModels:s,overflowModels:u}},m=()=>{let{allModelOptions:e}=p();return(t,n)=>{let a=e.find(e=>e.model===t);if(!a)return!1;let l=null==a?void 0:a.capabilities;return!l||!1!==l[n]}}},93049:(e,t,n)=>{n.d(t,{Ac:()=>r,D8:()=>i,bI:()=>o});let a="recentDriveDocs";function l(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function r(e){localStorage.setItem(a,JSON.stringify(e))}function o(){if("undefined"==typeof localStorage)return[];let e=localStorage.getItem(a);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(l))return t}return[]}function i(e){let t=o();r(t=t.filter(t=>t.uri!==e))}}}]);