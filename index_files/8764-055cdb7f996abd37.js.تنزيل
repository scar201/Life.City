"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8764],{2341:(e,t,n)=>{n.d(t,{B:()=>u,N:()=>s});var a=n(54568),r=n(7620);let i=(0,r.createContext)(null),u=()=>{let e=(0,r.useContext)(i);return void 0===e?null:e},s=e=>{let{children:t,settings:n}=e;return(0,a.jsx)(i.Provider,{value:n,children:t})}},7726:(e,t,n)=>{n.d(t,{sk:()=>L,dy:()=>S,Rs:()=>O,Fn:()=>w,CW:()=>E,bT:()=>A,t7:()=>P,Vt:()=>q,uE:()=>Q,OZ:()=>M,$z:()=>m,O2:()=>I,mz:()=>b,FG:()=>k,Bq:()=>T,EV:()=>C,Lo:()=>z,_W:()=>U,yu:()=>D,HA:()=>Y,HF:()=>R,Pt:()=>j,HI:()=>B,Du:()=>x,wR:()=>H,aC:()=>N,gG:()=>K,uC:()=>X,lj:()=>F});var a=n(98518),r=n(77186),i=n(1761),u=n(2341),s=n(53248),o=n(71473),l=n(7620);function c(e){let t=JSON.stringify(e);return(0,l.useMemo)(()=>e,[t])}var d=n(75632),y=n(70825),g=n(87606),v=n(7703),h=n(92012),f=n.n(h),p=n(62942),_=n(57067);let m=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,[r,u]=(0,l.useReducer)(e=>e+1,0),s=c([o.fC,{orgUUID:a},{uuid:e}]),d=(0,l.useMemo)(()=>t.getQueryData(s),[t,s,e,r]);return(0,l.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,v.MK)({queryKey:s},e.query)&&u()}),[t,u,s]),{data:d}},b=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,r=c([o.fC,{orgUUID:a},{uuid:e}]);return t.getQueryData(r)},L=30,S=1e4,C=e=>{let{limit:t,offset:n,enabled:a=!0,starred:u}=e,{activeOrganization:s}=(0,i.YL)(),l=null==s?void 0:s.uuid,c=new URLSearchParams;void 0!==t&&c.append("limit",t.toString()),void 0!==n&&c.append("offset",n.toString()),void 0!==u&&c.append("starred",u.toString());let d=c.toString();return d=d?"?".concat(d):"",(0,r.Sk)("/api/organizations/".concat(null!=l?l:"","/chat_conversations").concat(d),{queryKey:[o.DC,{orgUUID:l},{limit:t,offset:n,starred:u}],staleTime:3e5,enabled:!!l&&a})},w=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/chat_conversations/count_all"),{queryKey:[o.Ad,{orgUUID:t}],staleTime:3e5,enabled:!!t})},Q=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,r.mn)();return(0,l.useCallback)(async n=>{let{limit:a,offset:r}=n,i=new URLSearchParams;void 0!==a&&i.append("limit",a.toString()),void 0!==r&&i.append("offset",r.toString());let u=i.toString();return u=u?"?".concat(u):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(u))).json()},[null==e?void 0:e.uuid,t])},T=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:a}=(0,i.YL)(),u=null==a?void 0:a.uuid,s=(0,l.useRef)([]),c=(0,g.useQueryClient)(),d="/api/organizations/".concat(null!=u?u:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),y=(0,r.Sk)(d,{queryKey:[o.fC,{orgUUID:u},{uuid:e}],staleTime:3e5,enabled:!!u&&!!e&&n,meta:{noToast:t}},t=>(c.invalidateQueries({queryKey:[o.XF,{orgUUID:u,conversationUUID:e}]}),(0,_.H6)(t))),v=(0,l.useMemo)(()=>{if(!y.data)return s.current=[],s.current;let e=(0,_.$)(y.data);if(e.length!==s.current.length||e.some((e,t)=>{var n;return e.uuid!==(null==(n=s.current[t])?void 0:n.uuid)}))return s.current=e,s.current;for(let t=0;t<e.length;t++)f()(e[t],s.current[t])||(s.current[t]=e[t]);return s.current},[y.data]);return{...y,currentPath:v}},U=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid;return(0,l.useCallback)(()=>{t.invalidateQueries({queryKey:[o.fC,{orgUUID:a},{uuid:e}]})},[t,a,e])},A=(e,t)=>{let{mutateAsync:n}=E(),a=(0,p.useRouter)(),r=t||(0,d.N)();return(0,l.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:r,name:"",model:t.model};t.createMode&&(i.create_mode=t.createMode),t.projectUuid&&(i.project_uuid=t.projectUuid),n(i).then(()=>{let n="/chat/".concat(r).concat(t.controlsOpen?"?controls=1":"");a[e](n)}).catch(e=>{(0,y.Cp)(e)})},[n,a,e,r])},E=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)(),a=e=>[o.fC,{orgUUID:t},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{n.setQueryData(a(e.uuid),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map}))}})},P=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)();return(0,r.Qv)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let a=t.findIndex(e=>e.uuid===n);if(!(a>-1))return t;{let e=[...t];return e.splice(a,1),e}},{enabled:!!t,queryKey:[o.DC,{orgUUID:t}],onSuccess:async(e,a)=>{let{uuid:r,projectUuid:i}=a;await n.invalidateQueries({queryKey:[o.fC,{orgUUID:t},{uuid:r}]}),i&&await n.invalidateQueries({queryKey:[o.yF,{orgUuid:t,projectUuid:i}]}),await V(n,t)}})},q=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await V(a,n),e&&e(t)}})},D=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/shares"),{queryKey:[o._J,{orgUUID:t}],enabled:!!t,staleTime:3e5})},I=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[o.XF,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:a}=e;return{shareable:n,disabled_reason:a,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,_.XU)(e))}:null}})},k=e=>{let{activeOrganization:t,account:n}=(0,i.YL)(),a=null==t?void 0:t.uuid,u=n&&a?"/api/organizations/".concat(a,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,r.Sk)(u,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[o.Bn,{orgUUID:a,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,_.XU)(e))}))},x=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:[o.XF,{orgUUID:n,conversationUUID:e}]}),a.invalidateQueries({queryKey:[o._J,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]})}})},K=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(a,"/share/").concat(t),"DELETE",{enabled:!!a&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{u.invalidateQueries({queryKey:[o.XF,{orgUUID:a,conversationUUID:e}]}),u.invalidateQueries({queryKey:[o._J,{orgUUID:a}]}),u.invalidateQueries({queryKey:[o.A2,{orgUUID:a}]})}})},z=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[o.Fz,{artifactVersionUUID:e}]})},Y=function(e,t,n){var s,l,c;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:y}=(0,a.st)(),v=null!=(l=null==(s=(0,u.B)())?void 0:s.preview_feature_uses_artifacts)&&l,{activeOrganization:h}=(0,i.YL)(),f=null==h?void 0:h.uuid,p=(0,g.useQueryClient)(),_=[o.fC,{orgUUID:f},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=f?f:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!=(c=t.uuid)?c:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!f,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var a,r,i=arguments.length,u=Array(i),s=0;s<i;s++)u[s]=arguments[s];y({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:v,conversationHasArtifacts:n,type:null==(a=t.chat_feedback)?void 0:a.type}),p.invalidateQueries({queryKey:_}),null==(r=d.onSuccess)||r.call(d,...u)}})},G=()=>{let e=(0,g.useQueryClient)(),{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,l.useCallback)((t,a)=>{t&&(e.setQueryData([o.fC,{orgUUID:n},{uuid:t}],e=>e&&{...e,...a}),e.setQueriesData({queryKey:[o.DC,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...a})))},[n,e])},B=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=G();return(0,r.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var r;let{name:i}=n,s=t.getQueryData([o.fC,{orgUUID:a},{uuid:e}]);return u(e,{name:i}),{oldTitle:null!=(r=null==s?void 0:s.name)?r:""}},onError(t,n,a){a&&u(e,{name:a.oldTitle})}})},M=e=>{let t=G(),{activeOrganization:n}=(0,i.YL)();return(0,r.L2)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:a}=n;t(e,{name:null!=a?a:""})},meta:{noToast:!0}})};function O(e){var t,n;let a=(0,s.C)(e),r=e.attachments.map(e=>e.extracted_content).join(" ");return a+" "+r+" "+((null==(t=e.content)?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null==(n=e.content)?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let N=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},j=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},F=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},R=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=(0,g.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,r.Qv)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{V(a,u)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&a.refetchQueries({queryKey:[o.fC,{orgUUID:u},{uuid:e}]})},queryKey:[o.fC,{orgUUID:u},{uuid:e}]})},V=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[o.DC,{orgUUID:t}]}),e.invalidateQueries({queryKey:[o.Ad,{orgUUID:t}]})])},H=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,g.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{V(n,a)},queryKey:[o.fC,{orgUUID:a},{uuid:e}]})},X=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,g.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>{var n;return t?{...t,project_uuid:null!=(n=e.project_uuid)?n:void 0}:void 0},{onSuccess:()=>{V(n,a),n.invalidateQueries({queryKey:[o.yF]})},queryKey:[o.fC,{orgUUID:a},{uuid:e}]})}},29242:(e,t,n)=>{n.d(t,{m:()=>g});var a=n(42977),r=n(54568),i=n(90510),u=n(32987),s=n(37463),o=n(67754);function l(){let e=(0,a._)(["\n  px-2\n  py-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-md\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return l=function(){return e},e}function c(){let e=(0,a._)(["\n  max-w-[337px]\n  z-tooltip\n  [*:disabled_&]:hidden\n"]);return c=function(){return e},e}function d(){let e=(0,a._)(["\n  p-1\n  font-small-bold\n  rounded-lg\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return d=function(){return e},e}function y(){let e=(0,a._)(["\n  p-1\n  font-base\n  border-border-300\n  border-0.5\n  rounded-lg\n  shadow-diffused \n  shadow-[hsl(var(--always-black)/4%)]\n  text-text-100\n  bg-bg-100\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return y=function(){return e},e}function g(e){let{children:t,tooltipContent:n,contentStyle:a="default",side:i="top",sideOffset:s,align:l,className:c,delayDuration:d=200,...y}=e,g=f[a];return(0,r.jsx)(o.Kq,{delayDuration:d,children:(0,r.jsxs)(o.bL,{...y,children:[(0,r.jsx)(o.l9,{asChild:!0,children:t}),(0,r.jsx)(o.ZL,{children:(0,r.jsx)("span",{children:(0,r.jsx)(g,{className:(0,u.A)(c,!n&&"hidden"),sideOffset:null!=s?s:5,side:i,align:l,children:n})})})]})})}let v=(0,i.J)(o.UC)(l()),h=(0,i.J)(o.UC)(c()),f={default:v,citation:e=>{let{children:t,...n}=e;return(0,r.jsx)(h,{...n,children:(0,r.jsx)(s.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},className:"p-1 font-base text-text-200 bg-bg-100 break-words border-0.5 border-border-300/25 max-h-[300px] shadow-diffused shadow-[hsl(var(--always-black)/4%)] rounded-lg overflow-y-auto",children:t})})},inputMenu:(0,i.J)(o.UC)(d()),sampleImage:(0,i.J)(o.UC)(y())}},53248:(e,t,n)=>{n.d(t,{C:()=>a});let a=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},57067:(e,t,n)=>{n.d(t,{$:()=>p,AP:()=>d,GN:()=>l,Gp:()=>c,H6:()=>v,Rh:()=>s,XU:()=>y,ZQ:()=>h,gF:()=>o,gX:()=>_,gv:()=>u,xQ:()=>f});var a=n(70825),r=n(6363),i=n.n(r);let u="new-assistant-message-uuid",s="new-human-message-uuid",o="00000000-0000-4000-8000-000000000000",l=e=>e!==u;function c(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,a.Cp)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==o;){var a;let t=c(e.parentByChildUuid,n),r=null==(a=c(e.childrenByParentUuid,t))?void 0:a.indexOf(n);e.selectedChildByUuid.set(t,r),n=t}return{...e,current_leaf_message_uuid:t}},y=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},g=e=>{var t,n,a;let r=new Map,i=new Map,u=new Map,s=new Map,l=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:s,selectedChildByUuid:l};let c=e.chat_messages.map(y);for(let e of c)r.set(e.index,e),i.set(e.uuid,e);for(let e of c){let t=e.parent_message_uuid;if(!t){let a=e.index-1;for(;!t&&a>=0;)t=null==(n=r.get(a))?void 0:n.uuid,a--}t=null!=t?t:o,u.set(e.uuid,t),s.set(t,(null!=(a=s.get(t))?a:[]).concat(e.uuid)),l.set(t,0)}if(!(null==(t=s.get(o))?void 0:t[0]))throw Error("No root message found");return{chat_messages:c,messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:s,selectedChildByUuid:l}},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let a=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),r={...e,chat_messages:a},i={...r,...g(r)};return i.current_leaf_message_uuid||d(i),d(i,r.current_leaf_message_uuid)},h=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},f=(e,t)=>{for(let a of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!a.parent_message_uuid)throw Error("Parent UUID required");let t=a.parent_message_uuid;e.messageByUuid.set(a.uuid,a),e.parentByChildUuid.set(a.uuid,t);let r=null!=(n=e.childrenByParentUuid.get(t))?n:[];r.push(a.uuid),e.childrenByParentUuid.set(t,r),e.selectedChildByUuid.set(t,r.length-1)}return d(e,t[t.length-1].uuid)},p=(e,t)=>{let n=[],a=null!=t?t:o;for(;e.childrenByParentUuid.has(a);){let t=c(e.childrenByParentUuid,a);if(0===t.length)break;let r=c(e.selectedChildByUuid,a),i=c(e.messageByUuid,t[r]);n.push({...i,parent_message_uuid:a,nOptions:t.length,selectedOption:r}),a=i.uuid}return n};function _(e,t,n){var a;let r=c(e.parentByChildUuid,t.uuid),u=c(e.childrenByParentUuid,r),s=i()((null!=(a=t.selectedOption)?a:0)+n,0,u.length-1);e.selectedChildByUuid.set(r,s);let o=p(e,r);return d(e,o[o.length-1].uuid)}},75632:(e,t,n)=>{n.d(t,{N:()=>a});let a=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()},77101:(e,t,n)=>{n.d(t,{I5:()=>i,sb:()=>r,v8:()=>a,xj:()=>u});var a=function(e){return e.GITHUB="github",e.GDRIVE="gdrive",e.OUTLINE="outlin",e.SALESFORCE="sfdc",e.GMAIL="gmail",e.GCAL="gcal",e.SLACK="slack",e.ASANA="asana",e.CANVAS="canvas",e.FIDDLEHEAD="fiddlehead",e}({});let r={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana",canvas:"Canvas",fiddlehead:"Fiddlehead"};var i=function(e){return e.CREATED="created",e.PENDING="pending",e.FAILED="failed",e.UPDATING="updating",e.UPDATE_FAILED="update_failed",e.READY="ready",e.UNAUTHENTICATED="unauthenticated",e.ACCESS_DENIED="access_denied",e.DISABLED="disabled",e}({});let u=["access_denied","failed","unauthenticated","update_failed"]},91768:(e,t,n)=>{n.d(t,{Dd:()=>U,FZ:()=>C,LN:()=>m,X0:()=>K,XE:()=>q,Ys:()=>I,dH:()=>w,eL:()=>E,fe:()=>z,ob:()=>x,ph:()=>L,tS:()=>_,xc:()=>b,z3:()=>T});var a=n(68096),r=n(77186),i=n(1761),u=n(51121),s=n(29585),o=n(71473),l=n(27062),c=n(77101),d=n(90119),y=n(21036),g=n(87606),v=n(62942),h=n(7620),f=n(46760),p=n(40459);let _=e=>e.type===c.v8.GITHUB?{sync_source_type:c.v8.GITHUB,sync_source_config:e.config}:e.type===c.v8.GDRIVE?{sync_source_type:c.v8.GDRIVE,sync_source_config:e.config}:null,m=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[o._V,{orgUUID:t}],enabled:!!e})},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:a}=e;t||(t=[]);let r=t.map(e=>e.type===n?{...e,enabled:a}:e);return r.some(e=>e.type===n)?r:[...t,{type:n,enabled:a}]},{queryKey:[o._V,{orgUUID:n}],enabled:!!t,onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),u=0;u<r;u++)i[u]=arguments[u];await a.invalidateQueries({queryKey:[o._V,{orgUUID:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)(),{value:u}=(0,l.fS)("kingfisher_enabled"),{value:s}=(0,l.fS)("apps_use_bananagrams"),c=(0,y.useLayer)("trials_freemium").get("free_integrations",!1);return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:a}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...a}}:e)},{queryKey:[o._V,{orgUUID:n}],enabled:!!(t&&(u||c)&&s),onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),u=0;u<r;u++)i[u]=arguments[u];await a.invalidateQueries({queryKey:[o._V,{orgUUID:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},S=(e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let a=n.toString()?"?".concat(n.toString()):"",r=window.location.pathname+a;window.history.replaceState({...window.history.state,as:r,url:r},"",r)},C=e=>{let{callerIdentifier:t,successParam:n,handleOpen:a}=e,r=(0,v.useSearchParams)(),i=(0,h.useRef)(!1);(0,h.useEffect)(()=>{!r.has(n)||i.current||t&&t!==r.get(n)||(i.current=!0,S(n,r),a())},[r,t,a,n])},w=e=>{let{pathname:t,searchParams:n,queryString:a,isClaudeApp:r}=e,i="".concat(t,"?").concat(a),u=n.get("origin");if(u)i=u;else if(r){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,n=t.startsWith("/project/")&&e.test(t.slice(9)),r=t.startsWith("/chat/")&&e.test(t.slice(6)),u=n||r||"/new"===t?t:"/new";i="claude://claude.ai".concat(u,"?").concat(a)}return i},Q=e=>[c.I5.CREATED,c.I5.PENDING,c.I5.UPDATING].includes(e),T=e=>Q(e.status.state),U=e=>[c.I5.FAILED,c.I5.UPDATE_FAILED].includes(e.status.state),A=e=>{if(e instanceof s.LG)return e instanceof s.LG&&"access_denied"===e.errorCode},E=()=>{let{addError:e}=(0,u.Y)(),t=(0,g.useQueryClient)();return(n,a)=>{A(n)&&(e("Please try again. You may need to reconnect with your ".concat(c.sb[a.sync_source_type]," account.")),o.ku.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[o.GC]}))}},P={[c.v8.GCAL]:"enabled_foccacia",[c.v8.GMAIL]:"enabled_sourdough"},q=e=>{let t=e===c.v8.GCAL||e===c.v8.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:n}=(0,l.fS)(t),a=(0,y.useLayer)("trials_freemium").get("free_integrations",!1),r=n||(e===c.v8.GCAL||e===c.v8.GMAIL)&&a;return!p.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&r},D=e=>{let t=(0,i.mV)(),{data:n}=m(),a=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||a},I=e=>{let t=D(e);return!!(q(e)&&t)},k=e=>"sfdc"===e?"salesforce":e,x=function(e){let{callerIdentifier:t,handleAuthSuccess:n,pathname:a,queryString:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:o}=(0,i.YL)(),l=null==o?void 0:o.uuid,y=(0,v.usePathname)(),p=(0,v.useSearchParams)(),{addSuccess:_}=(0,u.Y)(),m=(0,f.A)(),b=I(e),L=(0,g.useQueryClient)(),S=(0,d.V)(),{data:Q,isFetched:T}=(0,r.Sk)("/api/organizations/".concat(l,"/sync/").concat(k(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:l}],enabled:!!(o&&b)}),U=(0,h.useRef)(!1),{mutate:A}=(0,r.L2)("/api/organizations/".concat(l,"/sync/").concat(k(e),"/auth/start"),"POST",{enabled:!!(o&&b),onSuccess:e=>{window.location.href=e.redirect_url}});C({callerIdentifier:t,successParam:"".concat(e,"_success"),handleOpen:()=>{_(m.formatMessage({defaultMessage:"Successfully connected to {integrationName}",id:"T7cL93l/KQ"},{integrationName:c.sb[e]})),null==n||n(!0)}});let{mutate:E}=(0,r.L2)("/api/organizations/".concat(l,"/sync/").concat(k(e),"/auth"),"DELETE",{enabled:!!(o&&b),onSuccess:()=>{L.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:l}]})}});return{isAuthenticated:b&&!!(null==Q?void 0:Q.is_authenticated),startAuth:()=>{if(!U.current&&b){let n=w({pathname:a||y,searchParams:p,queryString:"".concat(e,"_success=").concat(t).concat(s?"&".concat(s):""),isClaudeApp:S});if(S){window.location.href="/settings/connectors?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(n);return}U.current=!0,A({pre_auth_state:{origin:n},redirect_uri:new URL("/connect/".concat(k(e),"/callback"),window.location.origin).toString()})}},disconnect:E,isFetched:T}},K=(e,t)=>{var n,a;let r=I(e),{account:u}=(0,i.YL)(),s=P[e];return s?r&&(t?!!(null==t||null==(n=t.conversationSettings)?void 0:n[s]):!!(null==u||null==(a=u.settings)?void 0:a[s])):r},z=()=>{let{account:e}=(0,i.YL)(),{mutate:t}=(0,a.Jy)();return{toggleIntegrationEnabled:(n,a)=>{if(!e)return;let r=P[n];r&&t({...e.settings,[r]:a})}}}},98251:(e,t,n)=>{n.d(t,{Bg:()=>l,fR:()=>y,iV:()=>d,ih:()=>c,nI:()=>g});var a=n(77186),r=n(1761),i=n(51121),u=n(71473),s=n(77101),o=n(87606);let l=()=>{let{account:e,activeOrganization:t}=(0,r.YL)(),n=null==e?void 0:e.uuid,i=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(i,"/sync/mcp/drive/ingest"),"POST",{onSuccess:()=>{setTimeout(()=>{l.invalidateQueries({queryKey:[u.hx,{orgUuid:i,accountUuid:n,syncSourceType:s.v8.GDRIVE}]})},300)}})},c=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,{addError:n}=(0,i.Y)(),l=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/sync/ingestion/gdrive/clean_up"),"POST",{onSuccess:()=>{l.invalidateQueries({queryKey:[u.hx,{orgUuid:t,syncSourceType:s.v8.GDRIVE}]})},onError:e=>{n(e)}})},d=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(n,"/projects/").concat(e,"/kb/resync"),"POST",{enabled:!!e,meta:{noToast:!0},onSuccess:t=>{"done"===t.status&&i.invalidateQueries({queryKey:[u.qz,{orgUuid:n,projectUuid:e}]})}})},y=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid;return(0,a.Sk)("/api/organizations/".concat(i,"/projects/").concat(e,"/kb/stats"),{queryKey:[u.qz,{orgUuid:i,projectUuid:e}],enabled:!!e&&t})},g=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/organizations/".concat(t,"/conversation/backfill"),"POST",{})}}}]);